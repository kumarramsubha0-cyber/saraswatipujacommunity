const SERVER_URL = "PASTE_YOUR_SCRIPT_URL_HERE";

/* PAGE CONTROL */
function openPage(id){
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  document.getElementById(id).style.display="block";
  if(id==="history") loadHistory();
}

/* PAYMENT */
function payNow(){
  let n = donor.value;
  let a = +amount.value;

  if(!n || a<250 || a>5000){
    alert("Invalid details");
    return;
  }

  window.open(`https://www.upi.me/pay?pa=9471418396@ptyes&am=${a}`);

  fetch(SERVER_URL,{
    method:"POST",
    body:JSON.stringify({name:n,amount:a})
  });

  let t=new Date().toLocaleString();
  receiptBox.innerHTML=`
    <b>Organised by Mukesh Apartment</b><br>
    Name: ${n}<br>
    Amount: ₹${a}<br>
    ${t}<br>
    <b style="animation:glow 2s infinite">Thanks for Donation</b>
  `;
  openPage("success");
}

/* LOAD HISTORY */
function loadHistory(){
  fetch(SERVER_URL)
  .then(r=>r.json())
  .then(data=>{
    historyList.innerHTML="";
    data.forEach(r=>{
      let d=document.createElement("div");
      d.className="receipt";
      d.innerHTML=`
        <b>${r.name}</b><br>
        Amount: ₹${r.amount}<br>
        Date: ${r.date}<br>
        Time: ${r.time}
      `;
      historyList.appendChild(d);
    });
  });
}

/* SEARCH */
function searchReceipt(){
  let n=searchName.value;
  let a=searchAmt.value;

  fetch(`${SERVER_URL}?name=${n}&amount=${a}`)
  .then(r=>r.json())
  .then(r=>{
    if(!r){alert("No record found");return;}
    receiptBox.innerHTML=`
      <b>Organised by Mukesh Apartment</b><br>
      Name: ${r.name}<br>
      Amount: ₹${r.amount}<br>
      Date: ${r.date}<br>
      Time: ${r.time}
    `;
    openPage("success");
  });
}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Saraswati Puja Donation</title>
<style>
body{font-family:Arial;margin:0;background:#f5f5f5}
.page{display:none;padding:15px}
.active{display:block}
button{padding:10px 15px;margin:5px}
.receipt{background:#fff;padding:10px;margin:8px 0;border-radius:6px}
</style>
</head>
<body>

<!-- HOME PAGE -->
<div id="home" class="page active">
  <h2>Jay Maa Saraswati Puja</h2>
  <input id="donor" placeholder="Enter Name"><br><br>
  <input id="amount" type="number" placeholder="Amount"><br><br>
  <button onclick="payNow()">Pay Now</button>
  <button onclick="openPage('history')">History</button>
</div>

<!-- SUCCESS PAGE -->
<div id="success" class="page">
  <h2>Payment Success</h2>
  <div id="receiptBox"></div>
  <button onclick="openPage('home')">Back Home</button>
</div>

<!-- HISTORY PAGE -->
<div id="history" class="page">
  <h2>Payment History</h2>
  <div id="historyList"></div>
  <button onclick="openPage('home')">Back</button>
</div>

<script>
// ðŸ”´ PASTE YOUR GOOGLE APPS SCRIPT WEB APP URL HERE
const SERVER_URL = "https://script.google.com/macros/library/d/1_kdCYDKq42-bjuUHeRBMMmfUpXOTYwNmLErzCXavtf5khN7jSgyooQwT/1";

function openPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  const el = document.getElementById(id);
  if(el){ el.classList.add('active'); }
  if(id==='history') loadHistory();
}
function goHome(){openPage('home');}

// SAVE PAYMENT TO SERVER (GOOGLE SHEET)
function payNow(){
  let n = donor.value;
  let a = +amount.value;
  if(!n || a<250 || a>5000){ alert("Invalid details"); return; }

  window.open(`https://www.upi.me/pay?pa=9471418396@ptyes&tn=saraswati&am=${a}`);

  fetch(SERVER_URL,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ name:n, amount:a })
  });

  receiptBox.innerHTML = `<b>Organised by Mukesh Apartment</b><br>
  Name: ${n}<br>Amount: â‚¹${a}<br>
  <b style="animation:glow 2s infinite">Thanks for Donation</b>`;
  openPage('success');
}

// LOAD HISTORY FROM SERVER
function loadHistory(){
  fetch(SERVER_URL)
    .then(r=>r.json())
    .then(data=>{
      historyList.innerHTML='';
      data.forEach(r=>{
        let d=document.createElement('div');
        d.className='receipt';
        d.innerHTML=`<b>${r.name}</b><br>â‚¹${r.amount}<br>${r.date} ${r.time}`;
        historyList.appendChild(d);
      });
    });
}

// OPTIONAL: SERVER-SIDE SEARCH (simple client filter)
function searchReceipt(){
  let n=searchName.value, a=searchAmt.value;
  fetch(SERVER_URL)
    .then(r=>r.json())
    .then(data=>{
      let r=data.find(x=>x.name===n && String(x.amount)===String(a));
      if(r){
        receiptBox.innerHTML=`<b>Organised by Mukesh Apartment</b><br>
        Name: ${r.name}<br>Amount: â‚¹${r.amount}<br>${r.date} ${r.time}`;
        openPage('success');
      } else alert('No record found');
    });
}
</script>

</body>
</html>
